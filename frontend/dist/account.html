<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings - Velura</title>
    <link rel="icon" type="image/png" href="/assets/favicon.DFpwLE5M.webp">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script type="module" crossorigin src="/assets/account.C9DpUV9s.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/modulepreload-polyfill.YP0FEG5d.js">
  <link rel="stylesheet" crossorigin href="/assets/account.B2F11yyZ.css">
</head>

<body>
    <div class="account-container">
        <!-- Header -->
        <div class="account-header">
            <a href="/browse" class="back-button">
                <i class="bi bi-arrow-left"></i>
                Back to Browse
            </a>
            <h1
                style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                Account Settings
            </h1>
        </div>

        <!-- Main Layout -->
        <div class="account-layout">
            <!-- Sidebar -->
            <div class="account-sidebar">
                <div class="profile-section">
                    <div class="profile-picture" id="profilePicture">
                        <i class="bi bi-person"></i>
                    </div>
                    <div class="profile-name" id="userName">Loading...</div>
                    <div class="profile-email" id="userEmail">Loading...</div>
                </div>

                <div class="sidebar-nav">
                    <div class="nav-item active" data-section="overview">
                        <i class="bi bi-speedometer2 nav-icon"></i>
                        Overview
                    </div>
                    <div class="nav-item" data-section="membership">
                        <i class="bi bi-gem nav-icon"></i>
                        Membership
                    </div>
                    <div class="nav-item" data-section="security">
                        <i class="bi bi-shield-lock nav-icon"></i>
                        Security
                    </div>
                    <div class="nav-item" data-section="devices">
                        <i class="bi bi-laptop nav-icon"></i>
                        Devices
                    </div>
                    <div class="nav-item" data-section="profiles">
                        <i class="bi bi-people nav-icon"></i>
                        Profiles
                    </div>
                </div>

                <button class="btn btn-danger" style="width: 100%; margin-top: 40px;" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i>
                    Logout
                </button>
            </div>

            <!-- Main Content -->
            <div class="account-content">
                <!-- Messages -->
                <div class="message" id="message"></div>

                <!-- Overview Section -->
                <div class="content-section active" id="overviewSection">
                    <h2 class="section-title">Account Overview</h2>
                    <p class="section-subtitle">Welcome back! Manage your account settings and preferences in one place.
                    </p>

                    <!-- Membership Card -->
                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Your Membership</div>
                            <div class="plan-badge" id="overviewPlanBadge">Free</div>
                        </div>
                        <div class="plan-details">
                            <div class="detail-item">
                                <span class="detail-label">Current Plan</span>
                                <span class="detail-value" id="overviewPlan">Free Tier</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monthly Cost</span>
                                <span class="detail-value" id="overviewCost">$0.00</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Next Billing</span>
                                <span class="detail-value" id="overviewBilling">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Active Profiles</span>
                                <span class="detail-value" id="overviewProfiles">1/1</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Active Devices</span>
                                <span class="detail-value" id="overviewDevices">1/1</span>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="showSection('membership')">
                            <i class="bi bi-gear"></i>
                            Manage Membership
                        </button>
                    </div>

                    <!-- Quick Links -->
                    <h3 style="margin: 50px 0 25px 0; color: #f8fafc; font-size: 1.5rem; font-weight: 700;">Quick
                        Settings</h3>
                    <div class="quick-links">
                        <a href="javascript:void(0)" class="quick-link" onclick="showSection('membership')">
                            <i class="bi bi-arrow-up-circle quick-link-icon"></i>
                            <div class="quick-link-text">
                                <div class="quick-link-title">Change Plan</div>
                                <div class="quick-link-desc">Upgrade or downgrade your subscription plan</div>
                            </div>
                            <i class="bi bi-chevron-right quick-link-arrow"></i>
                        </a>
                        <a href="javascript:void(0)" class="quick-link" onclick="showSection('security')">
                            <i class="bi bi-key quick-link-icon"></i>
                            <div class="quick-link-text">
                                <div class="quick-link-title">Update Password</div>
                                <div class="quick-link-desc">Change your account password for security</div>
                            </div>
                            <i class="bi bi-chevron-right quick-link-arrow"></i>
                        </a>
                        <a href="javascript:void(0)" class="quick-link" onclick="showSection('profiles')">
                            <i class="bi bi-people quick-link-icon"></i>
                            <div class="quick-link-text">
                                <div class="quick-link-title">Manage Profiles</div>
                                <div class="quick-link-desc">Create and manage user profiles</div>
                            </div>
                            <i class="bi bi-chevron-right quick-link-arrow"></i>
                        </a>
                        <a href="javascript:void(0)" class="quick-link" onclick="showSection('devices')">
                            <i class="bi bi-laptop quick-link-icon"></i>
                            <div class="quick-link-text">
                                <div class="quick-link-title">Devices</div>
                                <div class="quick-link-desc">Manage your connected devices</div>
                            </div>
                            <i class="bi bi-chevron-right quick-link-arrow"></i>
                        </a>
                    </div>
                </div>

                <!-- Membership Section -->
                <div class="content-section" id="membershipSection">
                    <h2 class="section-title">Membership & Billing</h2>
                    <p class="section-subtitle">Manage your subscription plan and payment information.</p>

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Current Plan</div>
                            <div class="plan-badge" id="membershipPlanBadge">Free</div>
                        </div>
                        <div class="plan-details">
                            <div class="detail-item">
                                <span class="detail-label">Plan Name</span>
                                <span class="detail-value" id="membershipPlanName">Free Tier</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monthly Price</span>
                                <span class="detail-value" id="membershipPrice">$0.00/month</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Video Quality</span>
                                <span class="detail-value" id="membershipQuality">HD (720p)</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Profiles</span>
                                <span class="detail-value" id="membershipProfiles">1</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Devices</span>
                                <span class="detail-value" id="membershipDevices">1</span>
                            </div>
                        </div>
                    </div>

                    <div class="payment-info">
                        <div class="payment-item">
                            <div class="payment-label">Next Payment Date</div>
                            <div class="payment-value" id="nextPaymentDate">-</div>
                        </div>
                        <div class="payment-item">
                            <div class="payment-label">Payment Method</div>
                            <div class="payment-value" id="paymentMethod">No payment method</div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="changePlan()">
                            <i class="bi bi-arrow-up-circle"></i>
                            Change Plan
                        </button>
                        <button class="btn btn-secondary" onclick="managePaymentMethod()">
                            <i class="bi bi-credit-card"></i>
                            Update Payment Method
                        </button>
                        <button class="btn btn-secondary" onclick="viewPaymentHistory()">
                            <i class="bi bi-clock-history"></i>
                            Payment History
                        </button>
                    </div>

                    <div class="cancel-section" id="cancelSubscriptionSection" style="display: none;">
                        <div class="cancel-title">Cancel Subscription</div>
                        <div class="cancel-description">
                            If you cancel, you'll lose access to premium features at the end of your billing period.
                        </div>
                        <button class="btn btn-danger" onclick="cancelSubscription()" id="cancelSubscriptionBtn">
                            <i class="bi bi-x-circle"></i>
                            Cancel Subscription
                        </button>
                    </div>
                </div>

                <!-- Security Section -->
                <div class="content-section" id="securitySection">
                    <h2 class="section-title">Security Settings</h2>
                    <p class="section-subtitle">Manage your password and account security preferences.</p>

                    <!-- Password Change Card - Hidden for Google users -->
                    <div class="info-card" id="passwordChangeCard">
                        <div class="card-title" style="margin-bottom: 30px;">Change Password</div>
                        <form id="securityForm">
                            <div class="form-group">
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-input" id="currentPassword"
                                    placeholder="Enter your current password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-input" id="newPassword"
                                    placeholder="Enter new password (min 6 characters)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" class="form-input" id="confirmPassword"
                                    placeholder="Confirm your new password">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-shield-check"></i>
                                Update Password
                            </button>
                        </form>
                    </div>

                    <!-- Google Account Info Card - Only shown for Google users -->
                    <div class="info-card" id="googleAccountInfo" style="display: none;">
                        <div class="card-title" style="margin-bottom: 30px;">Google Account</div>
                        <div style="text-align: center; padding: 20px;">
                            <i class="bi bi-google" style="font-size: 3rem; color: #3b82f6; margin-bottom: 20px;"></i>
                            <p style="color: rgba(226, 232, 240, 0.8); font-size: 1.1rem; margin-bottom: 15px;">
                                Your account is managed through Google
                            </p>
                            <p style="color: rgba(226, 232, 240, 0.6); font-size: 0.95rem; margin-bottom: 25px;">
                                To change your password, please visit your Google Account settings.
                            </p>
                            <a href="https://myaccount.google.com/security" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-arrow-up-right-square"></i>
                                Go to Google Security Settings
                            </a>
                        </div>
                    </div>

                    <!-- Security Actions Card -->
                    <div class="info-card">
                        <div class="card-title" style="margin-bottom: 30px;">Security Actions</div>
                        <div class="button-group">
                            <button class="btn btn-secondary" onclick="signOutAllDevices()">
                                <i class="bi bi-laptop"></i>
                                Sign Out All Devices
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Devices Section -->
                <div class="content-section" id="devicesSection">
                    <h2 class="section-title">Connected Devices</h2>
                    <p class="section-subtitle">Manage devices that are signed in to your account.</p>

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Active Devices</div>
                            <button class="btn btn-outline" onclick="signOutAllDevices()">
                                <i class="bi bi-laptop"></i>
                                Sign Out All Devices
                            </button>
                        </div>
                        <div class="devices-list" id="devicesList">
                            <!-- Devices will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Profiles Section -->
                <div class="content-section" id="profilesSection">
                    <h2 class="section-title">Manage Profiles</h2>
                    <p class="section-subtitle">Create and manage profiles for different users.</p>

                    <!-- Messages Container -->
                    <div class="message" id="profileMessage" style="margin-bottom: 30px;"></div>

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Your Profiles</div>
                            <button class="btn btn-primary" onclick="addProfile()" id="addProfileBtn">
                                <i class="bi bi-plus-circle"></i>
                                Add Profile
                            </button>
                        </div>

                        <!-- Profile Limit Info -->
                        <div
                            style="margin-bottom: 25px; padding: 15px; background: rgba(59, 130, 246, 0.05); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                            <div style="display: flex; align-items: center; gap: 10px; color: #3b82f6;">
                                <i class="bi bi-info-circle"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 5px;">Profile Limits</div>
                                    <div style="font-size: 0.9rem; color: rgba(226, 232, 240, 0.8);">
                                        <span id="profileCount">0</span> of <span id="profileLimit">1</span> profiles
                                        used
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="profiles-grid" id="profilesGrid">
                            <!-- Profiles will be loaded here -->
                        </div>

                        <!-- Empty State -->
                        <div id="emptyProfilesState" style="display: none; text-align: center; padding: 50px 20px;">
                            <i class="bi bi-people"
                                style="font-size: 3rem; color: rgba(226, 232, 240, 0.3); margin-bottom: 20px;"></i>
                            <div style="font-size: 1.2rem; color: rgba(226, 232, 240, 0.7); margin-bottom: 10px;">
                                No profiles yet
                            </div>
                            <div
                                style="color: rgba(226, 232, 240, 0.5); margin-bottom: 30px; max-width: 400px; margin: 0 auto 30px;">
                                Create profiles for different family members or viewing preferences
                            </div>
                            <button class="btn btn-primary" onclick="addProfile()">
                                <i class="bi bi-plus-circle"></i>
                                Create Your First Profile
                            </button>
                        </div>
                    </div>

                    <!-- Profile Creation Tips -->
                    <div class="info-card"
                        style="margin-top: 30px; background: rgba(16, 185, 129, 0.05); border-color: rgba(16, 185, 129, 0.2);">
                        <div style="display: flex; align-items: flex-start; gap: 15px;">
                            <i class="bi bi-lightbulb" style="font-size: 1.5rem; color: #10b981;"></i>
                            <div>
                                <div style="font-weight: 600; color: #10b981; margin-bottom: 8px;">Profile Tips</div>
                                <div style="color: rgba(226, 232, 240, 0.8); font-size: 0.95rem;">
                                    • Each profile has its own watch history and recommendations<br>
                                    • Lock profiles with PIN for privacy<br>
                                    • Set age ratings to restrict content<br>
                                    • Main profile cannot be deleted or locked
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Verification Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <h3 class="modal-title">Verify Your Identity</h3>
            <p style="margin-bottom: 25px; color: rgba(226, 232, 240, 0.8);" id="passwordModalDescription">
                Please enter your password to continue.
            </p>
            <div class="form-group">
                <input type="password" class="form-input" id="verifyPassword" placeholder="Enter your password">
            </div>
            <div id="passwordError" class="modal-error"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="verifyPassword()">
                    <i class="bi bi-check-circle"></i>
                    Verify
                </button>
                <button class="btn btn-secondary" onclick="closePasswordModal()">
                    <i class="bi bi-x-circle"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- PIN Modal -->
    <div class="modal" id="pinModal">
        <div class="modal-content">
            <h3 class="modal-title" id="pinModalTitle">Enter Profile PIN</h3>
            <p id="pinModalDescription" style="margin-bottom: 25px; color: rgba(226, 232, 240, 0.8);">
                Enter the 4-digit PIN to unlock this profile
            </p>
            <div class="form-group">
                <input type="password" class="form-input" id="pinInput" placeholder="Enter 4-digit PIN" maxlength="4"
                    inputmode="numeric">
            </div>
            <div id="pinError" class="modal-error"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="verifyPin()">
                    <i class="bi bi-check-circle"></i>
                    Verify PIN
                </button>
                <button class="btn btn-secondary" onclick="closeModal('pinModal')">
                    <i class="bi bi-x-circle"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Email Verification Modal for Google Users -->
    <!-- ✅ KEEP THIS MODAL but update the description -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <h3 class="modal-title">Verify Your Identity</h3>
            <p style="margin-bottom: 25px; color: rgba(226, 232, 240, 0.8);">
                For security, we've sent a verification code to your email.
            </p>
            <div class="form-group">
                <input type="text" class="form-input" id="emailCode" placeholder="Enter 6-digit code" maxlength="6">
            </div>
            <div id="emailError" class="modal-error"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="verifySecurityCode()"> <!-- ✅ CHANGE FUNCTION NAME -->
                    <i class="bi bi-check-circle"></i>
                    Verify Code
                </button>
                <button class="btn btn-secondary" onclick="closeModal('emailModal')">
                    <i class="bi bi-x-circle"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

</body>

</html>